<!doctype html>
<html lang="en">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="color-scheme" content="light dark" />
	<title>Automating my Emacs configuration on my website</title>
	<link href="/static/favicon.ico" rel="icon" type="image/x-icon" />
	<meta charset="UTF-8" />
	<link href="/static/styles.css" rel="stylesheet" />
	<!-- Theme Checker before load -->
	<script src="js/anotherThemeChanger.js"></script>
</head>
<!-- Minimal theme switcher -->
<script src="/js/minimal-theme-switcher.js"></script>

<body class="container">
	<header>
		<nav>
			<ul>
				<li><a href="#" data-theme-switcher="light">Light</a></li>
				<li><a href="#" data-theme-switcher="dark">Dark</a></li>
			</ul>
		</nav>
	</header>
	<main>
		<h3>Continually updating my Emacs configuration on here</h3>
		<p>As you may hopefully have seen, I have my Emacs config files on my website (if not, well, they are <a
				href="emacsFiles.html">here</a>).</p>
		<p>Because I have a thing about making things look nice, I had to have syntax highlighting for these, and I had
			to have these match the colourscheme (which is of course based off of Catppuccin). I also wanted this to work
			without JavaScript, and so I decided to use Pygments.</p>

		<h5>Pygments</h5>
		<div class="syntax">
			<p>Pygments allowed me to generate a css style for the different styles I wanted to use (Catppuccin's Latte
				and
				Mocha), which once added to my css file, does not need any updating. This simply just defines a bunch of
				colours for different classnames for spans in a parent div - to generate the css styles simply
				run:<code><span class="sh">pygmentize </span> <span class="o">-f </span><span >html </span><span class="o">-S </span><span >catppuccin-style </span><span class="o">-a </span> <span >.syntax</span></code>
				where <code>catppuccin-style</code> was either catppuccin-mocha or catppuccin-latte dependng if I was
				generating the css for the light or dark mode.</p>
		</div>
		<p>For example, below you can see what an example of span class definition is, here the comment class is being
			defined:</p>
		<div class="syntax">
			<pre>
<span class="w">  </span><span class="p">.</span><span class="nc">syntax</span><span class="w"> </span><span class="p">.</span><span class="nc">c</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#7c7f93</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c">/* Comment */</span>
</pre>
		</div>
		<p>And then here you can see the actual HTML code provided by Pygments to display the above example (you do not
			want to know what the code to display the below example is - but if you do you can go look at the source
			code lol):</p>
		<div class="syntax">
			<pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;syntax&quot;</span><span class="p">&gt;&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span>  <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nc&quot;</span><span class="p">&gt;</span>syntax<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nc&quot;</span><span class="p">&gt;</span>c<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">&gt;</span>{<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;k&quot;</span><span class="p">&gt;</span>color<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">&gt;</span>:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mh&quot;</span><span class="p">&gt;</span>#7c7f93<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">&gt;</span>}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">&gt;</span>/* Comment */<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre>
		</div>
		<div class="syntax">
			<p>As you can see by the second example, this would be very unfun to do by hand. Thankfully, Pygments
				supports a
				lot of languages, and so I can simply pass in my <ins>*.el</ins> files, and have Pygments output the
				HTML
				version of them. The command I used for this was
				<code><span class="sh">pygmentize </span><span class="k">example.el </span> <span class="o">-O </span><span >cssclass=syntax </span><span class="o">-o </span><span class="k">example.el.html </span></code>.
			</p>
		</div>
		<h5>SSRI</h5>
		<p> Here is where <a href="ssri.html">SSRI</a> comes in - I did not want to setup some janky regex to update the
			<ins>emacsConfig.html</ins> file (yes, I have read this <a
				href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags">classic</a>)
			everytime I changed my config files (which, being an Emacs user, is about every two minutes). So, yes, to
			make sure my config files are updated on my website I went away and built a templating engine - good use of
			my time, 10/10 would recommend.
		</p>

		<h5>Recap so far</h5>
		<p>Okay, so currently we have covered that I needed to generate HTML files from my <ins>*.el</ins> files with
			Pygments, and
			then include them in my website using SSRI. Seems pretty simply, you could just do a git repo for you Emacs
			files and write a small script to run pygments on each file in there, and then link those to your website
			somehow. Any like, I could, but that wouldn't have been as fun.</p>

		<h5>Capistrano</h5>
		<p>What if, instead of doing that, I used Capistrano to automatically deploy my Emacs config files to my
			webserver, and then to build the new <ins>*.el.html</ins> files, and then rerun SSRI to automatically
			update my emacs config files with a single command? So I did that, turns out Rake files are weird and wild
			beasts, but I kind of like them (along with ruby) now lol.</p>
		<h6>Workflow</h6>
		<p>Initially we should cover all of my hooks, which are built off of using the Capistrano deploy hooks:</p>
		<details open>
			<summary>
				<h4 style="display:inline"><code>hooks.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">before</span><span class="w"> </span><span class="s1">&#39;deploy:starting&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">:uptime</span>
<span class="n">before</span><span class="w"> </span><span class="s1">&#39;deploy:starting&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">:gitpush</span>


<span class="n">after</span><span class="w"> </span><span class="s1">&#39;deploy:updated&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pygments:pygmentsSetup&#39;</span>
</pre>
</div>

		</details>
		<p class=syntax>
			The first thing that I want to happen when I run
			<code><span class="sh">bundle </span> <span class="kt">exec </span><span >cap </span><span >Prod </span> <span >deploy</span></code>
			is to check the uptime of my webserver, mostly so I can just see if I should update and reboot it. So,
			before starting a deployment the <code><span class="kt">:uptime</span></code> task runs:
		</p>
		<details open>
			<summary>
				<h4 style="display:inline"><code>uptime.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">desc</span><span class="w"> </span><span class="s2">&quot;Report Uptimes&quot;</span>
<span class="n">task</span><span class="w"> </span><span class="ss">:uptime</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="n">roles</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">host</span><span class="o">|</span>
<span class="w">    </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Running task on </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">, deploying at </span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:deploy_to</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Host </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">host</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">):</span><span class="se">\t</span><span class="si">#{</span><span class="n">capture</span><span class="p">(</span><span class="ss">:uptime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


		</details>
		<p class=syntax>
			The next step is to commit and push any changes to the config files (and any Capistrano files) to the remote
			git repo, so the <code><span class="kt">:gitpush</span></code> task is run, which creates a commit with any
			changes, with the commit message being the current time, and then pushes to the remote repo.
		</p>
		<details open>
			<summary>
				<h4 style="display:inline"><code>gitCommit.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">desc</span><span class="w"> </span><span class="s1">&#39;push local repo to git&#39;</span>
<span class="n">task</span><span class="w"> </span><span class="ss">:gitpush</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">run_locally</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">timeOfPushCommitMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">capture</span><span class="p">(</span><span class="ss">:date</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="n">execute</span><span class="w"> </span><span class="ss">:git</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
<span class="w">    </span><span class="n">execute</span><span class="w"> </span><span class="ss">:git</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;commit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">timeOfPushCommitMessage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&#39;&quot;</span>
<span class="w">    </span><span class="n">execute</span><span class="w"> </span><span class="ss">:git</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;push&quot;</span>

<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

		</details>
		<p class=syntax>
			Now for the fun part, where we actually deploy the files - we wait until after the <code
				class=s1>deploy:updated</code> task has finished, and then we call the <code
				class=s1>pygments:pygmentsSetup</code> task:
		<details open>
			<summary>
				<h4 style="display:inline"><code>pygments.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">namespace</span><span class="w"> </span><span class="ss">:pygments</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="no">ARRAY</span><span class="o">=</span><span class="sx">%w{config.el packages.el init.el}</span><span class="p">;</span>
<span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s2">&quot;Runs pygments on config files&quot;</span>
<span class="w">  </span><span class="n">task</span><span class="w"> </span><span class="ss">:pygmentsSetup</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">on</span><span class="w"> </span><span class="n">roles</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">host</span><span class="o">|</span>
<span class="w">      </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Running pygments on </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="no">ARRAY</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">file</span><span class="o">|</span>
<span class="w">        </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;running pygmentize on </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="n">dirPath</span><span class="w"> </span><span class="o">=</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="n">dirPathHTML</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">dirPath</span><span class="si">}</span><span class="s2">.html&quot;</span>
<span class="w">        </span><span class="n">execute</span><span class="w"> </span><span class="ss">:pygmentize</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">dirPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-O&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cssclass=syntax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">dirPathHTML</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">      </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="ss">:cpPressri</span><span class="p">)</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

		</details>
		</p>
		<p class=syntax>

			This task takes the config files, and runs Pygments on them, creating the <ins>*.el.html</ins> files, and
			then invokes the <code><span class="kt">:cpPressri</span></code> task.
		<details open>
			<summary>
				<h4 style="display:inline"><code>cpPreSSRI.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">newarray</span><span class="o">=</span><span class="sx">%w{config.el.html packages.el.html init.el.html}</span><span class="p">;</span>
<span class="n">desc</span><span class="w"> </span><span class="s2">&quot;Copies files to right location before ssri&quot;</span>
<span class="n">task</span><span class="w"> </span><span class="ss">:cpPressri</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="n">roles</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">host</span><span class="o">|</span>
<span class="w">    </span><span class="n">newarray</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">file</span><span class="o">|</span>
<span class="w">      </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Copying </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="n">dirPath</span><span class="w"> </span><span class="o">=</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="n">execute</span><span class="w"> </span><span class="ss">:cp</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">dirPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/webserver/dir/path/&quot;</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>
<span class="w">  </span><span class="n">invoke</span><span class="p">(</span><span class="ss">:ssriRun</span><span class="p">)</span>
<span class="k">end</span>
</pre>
</div>

		</details>
		</p>
		<p class="syntax">
			This simply copies the files into the webserver directory, and then invokes the
			<code><span class="kt">:ssriRun</span></code> task.
		</p>
		<details open>
			<summary>
				<h4 style="display:inline"><code>ssriRun.rake</code></h4>
			</summary>
			<div class="syntax">
    <pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">mainDirLoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/webserver/dir/path/&quot;</span>
<span class="n">desc</span><span class="w"> </span><span class="s2">&quot;Runs ssri&quot;</span>
<span class="n">task</span><span class="w"> </span><span class="ss">:ssriRun</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="n">roles</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">host</span><span class="o">|</span>
<span class="w">    </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Running SSRI on </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="n">staging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">mainDirLoc</span><span class="si">}</span><span class="s2">/staging&quot;</span>
<span class="w">    </span><span class="n">templates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">mainDirLoc</span><span class="si">}</span><span class="s2">/templates&quot;</span>
<span class="w">    </span><span class="n">sites</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">mainDirLoc</span><span class="si">}</span><span class="s2">/sites&quot;</span>
<span class="w">    </span><span class="n">execute</span><span class="w"> </span><span class="ss">:ssri</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">staging</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-t&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">templates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">sites</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--no-warnings&quot;</span><span class="s2">&quot;-c&quot;</span>

<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

		</details>
		<p>
		This runs SSRI on directory, adding the newly generated <ins>*.el.html</ins> files to <ins>emacsFiles.html</ins>.
		</p>

		<h5>Closing thoughts</h5>
		<p>
			Was it a good use of my time to devlop a templating engine, learn ruby and rake files, and to setup Capistrano, just to save myself from occasionally having to copy and paste some HTML into a file? Probably not - but, it was kinda fun and I was bored.
		</p>
	</main>
		<footer class="container">
		<a href="/"> Main Page </a>
	</footer>



</body>

</html>
